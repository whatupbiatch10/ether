<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="//cdn.rawgit.com/twbs/bootstrap/v4.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropper/2.3.4/cropper.min.css" rel="stylesheet">
    <link href="dist/css/bootstrap-colorpicker.css" rel="stylesheet">
    <style>
   
        .frame {
            width: 600px;
            height: 800px;
            text-align: center;
            position: relative;
        }
        .frame img {
            max-width: 100%;
        }
        .cardborder {
            z-index: -1;
            width: 591px;
            height: 769px;
            position: absolute;
            fill: rgb(227, 228, 230);
            /* stroke: black; */
            stroke-width: 2px;
            left: 5px;
        }
        .internalborder {
            z-index: -2;
            width: 458px;
            height: 600px;
            position: absolute;
            fill: white;
            stroke: black;
            stroke-width: 2px;
            left: 76px;
            top: 147px;
            object-fit: cover;
            object-position: center;
        }
        input[type=file] {
            padding: 10px;
            background: #2d2d2d;
        }
        .page {
            margin: 1em auto;
            max-width: 768px;
            display: flex;
            align-items: flex-start;
            flex-wrap: wrap;
            height: 100%;
        }
        .box {
            padding: 0.5em;
            width: 100%;
            margin: 0.5em;
        }

        .box-2 {
            padding: 0.5em;
            width: calc(100%/2 - 1em);
        }

        .options label,
        .options input {
            width: 4em;
            padding: 0.5em 1em;
        }

        .btn {
            background: white;
            color: black;
            border: 1px solid black;
            padding: 0.5em 1em;
            text-decoration: none;
            margin: 0.8em 0.3em;
            display: inline-block;
            cursor: pointer;
        }

        .hide {
            display: none;
        }

        img {
            max-width: 100%;
        }
    </style>
</head>

<body>


    <main>
        <div class="container">
            <div class="jumbotron">
                <h1>Bootstrap Colorpicker Demo</h1>
                <input id="demo" type="text" class="form-control" value="rgb(255, 128, 0)" />
                <!-- <button id="colorbicker">Choose Color</button> -->
            </div>
            <div id="something">
                <svg class="cardborder">
                    <use xlink:href="#main_border"></use>
                   
                        <symbol viewBox="0 0 1223 1808" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="main_border">
                          <title>Combined Shape</title>
                          <defs>
                            <path d="M617.026 0C686.89 0 744.39 39.333 789.524 118H1223v1690H0V118h433.822C472.172 39.333 533.239 0 617.026 0zm-259.74 454.54h-12.702l-5.083 1.596-2.358 6.329-.836 7.231 4.136 10.25 4.141 8.496 9.623 8.423 8.066 6.623-1.168 5.219-6.898 2.66-20.602-6.886-12.43-5.817-2.654-5.858-1.051 2.99-4.944 13.938-7.439 18.455-12.88 23.18-21.818 27.31-16.34 17.784-17.375 15.648-19.998 16.724-14.575 8.162-12.21 8.82-27.105 13.395c-11.08 8.504-16.868 12.756-17.364 12.756-.496 0-3.744 2.543-9.745 7.628l-5.476 6.715-3.198 4.127 1.06 6.84 22.197 13.753 15.164 12.93v9.67l-11.676 4.635-11.452 2.211-11.208-2.211-16.223-2.154-9.664-2.481-4.845-1.199-4.302 1.199-3.698 4.635v17.773l-1.757 4.383-2.15 4.506-4.289 3.03-7.328 1.474v1.917l1.068 13.513-1.068 13.172-2.85 8.852.92 11.851v7.13l6.778 3.785h8.92l4.59-1.368 13.278-9.547 8.593-11.851 4.199-2.965 6.804 2.965 1.137 7.634-6.392 13.764-18.674 21.598-11.78 19.438-3.905 10.048-9.144 29.017-2.474 10.282-1.93 8.268-.92 356.26c3.002-.785 4.776-1.178 5.324-1.178s4.898-2.392 13.05-7.177l11.779-12.008 9.082-7.55h3.844v5.777l-3.844 10.09-6.901 13.98-10.262 30.845v21.347l4.302 12.227 3.779 10.65 2.181 18.685-3.866 14.22-.004.015v22.06l6.022 14.896c5.027 1.835 8.222 3.2 9.586 4.096 2.044 1.342 6.623-1.343 8.232-1.343 1.074 0 2.378-.627 3.915-1.883l12.095 3.226-4.178 6.283-5.44 35.44 3.681 2.535 11.063 1.703 8.495 10.223 3.78 6.02-1.85 7.808-1.93 4.554v4.984l8.319 2.662 23.218 2.375 29.222 8.72 28.216 14.625 30.564 29.88 18.456 37.695 7.144 4.15 14.608 2.563 11.742-4.751 14.452-5.131h8.077l2.948 5.131v11.435l-37.219 37.811v3.449l6.679 9.286 9.158 3.407h21.382l10.204 3.656 5.952 8.534 14.634 3.445 13.822 2.292 15.602-5.737h8.097v17.821l7.363 8.379 11.848 5.083 27.277-5.083 46.973-30.342h8.871l2.396 9.88-17.891 39.567H699.53l7.327-1.816v-2.047l-10.638-7.04-9.448-10.505-4.893-6.076 1.692-12.084 6.433-5.737h9.527l39.621 22.148c15.209 2.701 23.833 4.667 25.873 5.898 2.04 1.23 7.148.615 15.323-1.846l13.158-8.379v-6.465l7.503-3.11h26.015c5.158-1.672 8.3-2.509 9.423-2.509 1.124 0 3.133-3.293 6.027-9.879l9.086-8.048h36.498l7.525-18.078-2.856-5.24-4.669-2.909-18.177-12.775-8.732-19.85 8.732-4.347 19.946 4.346h9.332l26.074-8.497h21.656l19.365 4.15h7.19l11.214-20.373 7.03-28.31 3.168-10.902 6.932-6.812 22.464-5.328 8.218-5.41 6.6-9.214 3.234-23.296 7.349-13.828 18.847-10.223 4.477-4.238-2.097-8.701v-18.175l6.888-8.564 7.307-3.357 13.686-8.526 5.493-10.004 2.39-8.82-2.39-8.286-1.842-26.497-3.65-12.413 5.492-10.396 11.013-17.984 4.741-7.66-2.886-13.327-18.36-28.055v-28.944h7.882l20.395 18.656V904l-44.847-66.786-4.424-30.328 4.424-7.953 16.57 7.953 13.92 9.026 9.445-9.026v-23.037l-15.483-30.27-24.452-9.326-45.334-10.622 5.446-15.608 22.428-16.899v-30.98l-10.996-25.8-16.878-34.45-19.228-19.893-20.721-14.673 14.592-6.956v-10.948l-23.507-19.366-33.364-19.773-9.876-16.327-19.52-12.044-17.32 12.044-28.415 9.409h-38.816l17.064-21.453V473.6l-28.012-16.242h-31.871l-38.168 22.59-22.633 9.967H713v-24.366c-6.6-5.46-12.194-8.191-16.781-8.191H534.737l-35.84 16.242v16.315h-31.215L447.508 473.6l-26.314-16.242H401.17l-43.884-2.816z"
                              id="a"></path>
                          </defs>
                          <use xlink:href="#a" fill-rule="evenodd"></use>
                        </symbol>
                     
                </svg>
                <img id="myimg2" class="hide" src="./cardbordernew.png" alt="cardborder">
                <div class="frame" id="cardboard">
                    

                    <!-- <img id="myimg2" src="./cardbordernew.png" alt="cardborder"> -->
                    <!-- <input type='file' onchange="readURL(this);" /> -->
                    <!-- <img class="internalborder" src="./internalborder.png" alt="internalborder"> -->
                    <div class="box-2 img-result hide">
                        <!-- result of crop -->
                        <img class="cropped internalborder" src="" alt="">
                    </div>


                </div>
            </div>
        </div>
        <main class="page">

            <!-- input file -->
            <div class="box">
                <input type="file" id="file-input">
            </div>
            <!-- leftbox -->
            <div class="box-2">
                <div class="result"></div>
            </div>
            <!--rightbox-->
            <div class="box-2 img-result hide">
                <!-- result of crop -->
                <img class="cropped" src="" alt="">
            </div>
            <!-- input file -->
            <div class="box">
                <div class="options hide">
                    <label> Width</label>
                    <input type="number" class="img-w" value="300" min="100" max="1200" />
                </div>
                <!-- save btn -->
                <button class="btn save hide">Save</button>
                <!-- download btn -->
                <!-- <a href="" class="btn download">Download</a> -->
                <button id="dwndiv" onClick="downloadimg()">Download</button>
            </div>
        </main>
       
    </main>
    <img id="pg" />
    <img id="myimg" class="cardborder" src="" alt="" />
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="//cdn.rawgit.com/twbs/bootstrap/v4.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="dist/js/bootstrap-colorpicker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/0.8.1/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"
        integrity="sha256-c3RzsUWg+y2XljunEQS0LqWdQ04X1D3j22fd/8JCAKw=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"
        integrity="sha256-htuR1Owx8i9hm4h4Y4d/FjlPLoj2teQmhJ5WnNSo3w0=" crossorigin="anonymous"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tinyColorPicker/1.1.1/jqColorPicker.min.js"></script> -->
    <h5>mycanvas</h5>
    <canvas id="mycanvas" width="1323" height="1808"></canvas>
    <script>
         var svg = document.querySelector('svg');
                var img = document.querySelector('#myimg');
               

                // get svg data
                var xml = new XMLSerializer().serializeToString(svg);

                // make it base64
                var svg64 = btoa(xml);
                var b64Start = 'data:image/svg+xml;base64,';

                // prepend a "header"
                var image64 = b64Start + svg64;

                // set it as the source of the img element
                img.src = image64;
              
        $(function () {
            // Basic instantiation:
            //   $('#colorbicker').colorPicker({
            //         renderCallback: function(colors, mode){

            //         },
            //     });
            $('#demo').colorpicker();

            // Example using an event, to change the color of the .jumbotron background:
            $('#demo').on('colorpickerChange', function (event) {
                $('.jumbotron').css('background-color', event.color.toString());
                $('.cardborder').css('fill', event.color.toString());
                var svg = document.querySelector('svg');
                var img = document.querySelector('#myimg');
               

                // get svg data
                var xml = new XMLSerializer().serializeToString(svg);

                // make it base64
                var svg64 = btoa(xml);
                var b64Start = 'data:image/svg+xml;base64,';

                // prepend a "header"
                var image64 = b64Start + svg64;

                // set it as the source of the img element
                img.src = image64;
               
            });
        });

        //     function readURL(input) {
        //     if (input.files && input.files[0]) {
        //         var reader = new FileReader();

        //         reader.onload = function (e) {
        //             $('.internalborder')
        //                 .attr('src', e.target.result);
        //         };

        //         reader.readAsDataURL(input.files[0]);
        //     }
        // }    

        // vars
        let result = document.querySelector('.result'),
            img_result = document.querySelector('.img-result'),
            img_w = document.querySelector('.img-w'),
            img_h = document.querySelector('.img-h'),
            options = document.querySelector('.options'),
            save = document.querySelector('.save'),
            cropped = document.querySelector('.cropped'),
            // dwn = document.querySelector('.download'),
            upload = document.querySelector('#file-input'),
            cropper = '';

        // on change show image with crop options
        upload.addEventListener('change', (e) => {
            if (e.target.files.length) {
                // start file reader
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (e.target.result) {
                        // create new image
                        let img = document.createElement('img');
                        img.id = 'image';
                        img.src = e.target.result
                        // clean result before
                        result.innerHTML = '';
                        // append new image
                        result.appendChild(img);
                        // show save btn and options
                        save.classList.remove('hide');
                        options.classList.remove('hide');
                        // init cropper
                        cropper = new Cropper(img);
                    }
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });
        var temp_canvas;
        // save on click
        save.addEventListener('click', (e) => {
            e.preventDefault();
            // get result to data uri
            let imgSrc = cropper.getCroppedCanvas({
                width: img_w.value // input value
            }).toDataURL();
            // remove hide class of img
            cropped.classList.remove('hide');
            img_result.classList.remove('hide');
            // show image cropped
            cropped.src = imgSrc;
            var element = $("#cardboard"); // global variable
            var getCanvas; // global variable

            html2canvas(element, {
                onrendered: function (canvas) {
                    $("#copyDiv").append(canvas);
                    getCanvas = canvas;
                    temp_canvas = canvas;
                    $('#pg').attr('src', canvas.toDataURL());
                    var canvas = document.getElementById('mycanvas');
                    var ctx = canvas.getContext('2d');
                   
                    var img = new Image();
                    var imageObj2 = new Image();
                    var imageObj3 = new Image();
                    img.src = document.getElementById("pg").src;
                    img.onload = function () {
                        ctx.drawImage(img, 0, 0, 1223, 1808);
                       
                        imageObj2.src = document.getElementById("myimg").src;
                        imageObj2.onload = function() {
                           
                            ctx.drawImage(imageObj2, 0, 0);
                            imageObj3.src = document.getElementById("myimg2").src;
                            imageObj3.onload = function() {
                                ctx.drawImage(imageObj3, -50, 0);
                            var img = canvas.toDataURL("image/png");
                            document.write('<img src="' + img + '" width="500" height="750"/>');
                            }
                        }
                        // var imgURI = canvas
                        //     .toDataURL('image/png')
                        //     .replace('image/png', 'image/octet-stream');

                        // triggerDownload(imgURI);
                    };
                }
            });

            //   dwn.classList.remove('hide');
            //   dwn.download = 'imagename.png';
            //   dwn.setAttribute('href',imgSrc);
        });

        function downloadimg() {
            temp_canvas.toBlob(function (blob) {
                        saveAs(blob, "pretty image.png");
                    });
        }
    </script>
   
</body>

</html>